--- skipstone-0.8.3/src/mozilla.cpp.orig	2003-08-04 22:18:51.000000000 +0200
+++ skipstone-0.8.3/src/mozilla.cpp	2003-08-04 22:53:02.000000000 +0200
@@ -546,7 +546,7 @@
      	if (!nsDoc) D_RETURN_ (  CONTEXT_NONE );
      
      	nsIURI *baseURI;
-     	result = doc->GetBaseURL(baseURI);
+     	result = doc->GetBaseURL(&baseURI);
      	if (NS_FAILED(result) || !baseURI) D_RETURN_ (  CONTEXT_NONE );
 
      	nsString mime;
@@ -738,9 +738,9 @@
      	if (!NS_SUCCEEDED (result) || !contentViewer) D_RETURN_ ( FALSE );
      	nsCOMPtr<nsIMarkupDocumentViewer> mdv = do_QueryInterface(contentViewer,&result);
 	if (NS_FAILED(result) || !mdv) D_RETURN_ ( FALSE );
-	nsAutoString mCharset;
-        mCharset.AssignWithConversion (aCharSet);
-        result = mdv->SetForceCharacterSet(ToNewUnicode(mCharset));
+	nsCAutoString mCharset;
+        mCharset.AssignWithConversion ((PRUnichar*)aCharSet);
+        result = mdv->SetForceCharacterSet(mCharset);
      	D_RETURN_ ( NS_SUCCEEDED(result) ? TRUE : FALSE );
 }
      
@@ -778,7 +778,7 @@
 {
         PRInt32 sSize,dSize;
         gchar *output;
-        nsAutoString platformCharset;
+        nsCAutoString platformCharset;
         nsresult rv;
 
         /* sanity */
@@ -805,8 +805,10 @@
         }
         if (NS_SUCCEEDED(rv))
         {
-                rv = ccm->GetUnicodeEncoder(&platformCharset,
+		char *buf = ToNewCString(platformCharset);
+                rv = ccm->GetUnicodeEncoder(buf,
                                             getter_AddRefs(encoder));
+		nsMemory::Free(buf);
         }
         if (NS_SUCCEEDED(rv)) {
                 sSize = str.Length ();
@@ -837,7 +839,7 @@
 {
         PRInt32 sSize,dSize;
         PRUnichar *uniStr;
-        nsAutoString platformCharset;
+        nsCAutoString platformCharset;
         nsresult rv;
 
         /* sanity */
@@ -863,8 +865,10 @@
         }
         if (NS_SUCCEEDED(rv))
         {
-                rv = ccm->GetUnicodeDecoder(&platformCharset,
+		char *buf = ToNewCString(platformCharset);
+                rv = ccm->GetUnicodeDecoder(buf,
                                             getter_AddRefs(decoder));
+		nsMemory::Free(buf);
         }
         if (NS_SUCCEEDED(rv))
         {
--- skipstone-0.8.3/src/PromptService.cpp.orig	2003-08-04 22:18:51.000000000 +0200
+++ skipstone-0.8.3/src/PromptService.cpp	2003-08-04 22:54:05.000000000 +0200
@@ -470,7 +470,7 @@
 {
         PRInt32 sSize,dSize;
         gchar *output;
-        nsAutoString platformCharset;
+        nsCAutoString platformCharset;
         nsresult rv;
 
         /* sanity */
@@ -497,8 +497,10 @@
         }
         if (NS_SUCCEEDED(rv))
         {
-                rv = ccm->GetUnicodeEncoder(&platformCharset,
+		char *buf = ToNewCString(platformCharset);
+                rv = ccm->GetUnicodeEncoder(buf,
                                             getter_AddRefs(encoder));
+		nsMemory::Free(buf);
         }
         if (NS_SUCCEEDED(rv)) {
                 sSize = str.Length ();
